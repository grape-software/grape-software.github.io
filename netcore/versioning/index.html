<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Fernando Ruiz" /><link rel="canonical" href="https://grape-software.github.io/netcore/versioning/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>versionning - Grape Docs</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "versionning";
        var mkdocs_page_input_path = "netcore\\versioning.md";
        var mkdocs_page_url = "/netcore/versioning/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Grape Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../working/">Working</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../semantic-release/">Releasing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../logs/">Logs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../angular/">Angular</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../autocomplete/">Autocomplete</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../b4to5/">Bootstrap 4 to 5</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../http-services/">External Services</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../linter/">Linter Config</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../microfronts/">Microfronts</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../microservices/">Microservices</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../schema-compare/">Schema Compare</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../videos/">Videos snippets</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../powerbi/">Powerbi</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../environment-dev/">Environment Dev</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../neox/">Neox deploy</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../ms-jobs/">Microservicio Jobs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../nginx_config_angular/">Nginx angular</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">versionning</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#packetes-que-se-necesitan">Packetes que se necesitan</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#configuracion-del-programcs">Configuración del Program.cs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#implementaciones-posibles">Implementaciones posibles</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#en-el-mismo-archivo-del-contrlador">En el mismo archivo del contrlador</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#en-otro-archivo-con-el-mismo-nombre-del-controlador">En otro archivo con el mismo nombre del controlador</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../authentication/">authentication</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Grape Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">versionning</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="como-versionar-una-api-en-c-con-aspnet-core">Como versionar una API en C# con ASP.NET Core</h1>
<p>Referencia https://code-maze.com/aspnetcore-api-versioning/
Oficial Microsoft https://github.com/Microsoft/api-guidelines/blob/master/Guidelines.md#12-versioning</p>
<p>Con este documento se puede configurar el versionado de una API para que se puedan llamar de diferentes formas, por ejemplo: - agregando la versión en la url /v1 o /vX - en el header con el parámetro X-Version y el número de versión - en el query string ?api-version=2.0</p>
<p>Con un contrato específico se podría configurar 1 solo mecanismo de identificación de la versión, pero en este caso se configuran los 3 para que se pueda llamar de cualquiera de las 3 formas según la definición del cliente. Esto implica tener un poco más de código, pero es más flexible.
Es importante cuando se configurar el versionado, tener en cuenta que se puede configurar un default, que es la versión que se va a usar cuando no se especifique ninguna versión. En este caso se configura la versión 1.0 como default, si se cambia se intentará buscar siempre la más nueva y si no existe busca la anterior.</p>
<h2 id="packetes-que-se-necesitan">Packetes que se necesitan</h2>
<p>Tener en cuenta la version del NET Core que se esta usando. Mirar en el archivo .csproj y Nuget.org</p>
<pre><code class="language-bash">dotnet add package Asp.Versioning.Mvc
dotnet add package Asp.Versioning.MvcApiExplorer
</code></pre>
<h2 id="configuracion-del-programcs">Configuración del Program.cs</h2>
<p>Luego de inicializar el builder, agregar la configuración de versionado al finalizar el resto de las inicializaciones, justo antes de construir la aplicación.</p>
<pre><code class="language-csharp">builder.Services.AddApiVersioning(o =&gt;
    {
        o.AssumeDefaultVersionWhenUnspecified = true;
        o.DefaultApiVersion = new ApiVersion(1, 0);
        o.ReportApiVersions = true;
        o.ApiVersionReader = ApiVersionReader.Combine(
            new QueryStringApiVersionReader(&quot;api-version&quot;),
            new HeaderApiVersionReader(&quot;X-Version&quot;),
            new MediaTypeApiVersionReader(&quot;ver&quot;));
    })
    .AddMvc()
    .AddApiExplorer(
        options =&gt;
        {
            options.GroupNameFormat = &quot;'v'VVV&quot;;
            options.SubstituteApiVersionInUrl = true;
        });
// antes del
var app = builder.Build();
</code></pre>
<h2 id="implementaciones-posibles">Implementaciones posibles</h2>
<p>Para poder versionar una API se pueden hacer de dos formas. Una es en el mismo archivo del controlador y otra en un archivo con el mismo nombre del controlador pero en otro namespace.</p>
<h3 id="en-el-mismo-archivo-del-contrlador">En el mismo archivo del contrlador</h3>
<p>Se agregan las etiquetas con las versiones en el mismo archivo del controlador</p>
<pre><code class="language-csharp">[ApiController]
[ApiVersion(&quot;1.0&quot;)]
[ApiVersion(&quot;2.0&quot;)]
// permite tener las dos url /v1/ y /v2/. Además, pasarle en el header X-Version la versión que se quiere o en el query string ?api-version=2.0
[Route(&quot;v{version:apiVersion}/[controller]&quot;)]
[Route(&quot;[controller]&quot;)]
</code></pre>
<p>Se agrega en el método que quiero sea de una versión en específico</p>
<pre><code class="language-csharp">[HttpGet]
[MapToApiVersion(&quot;1.0&quot;)]
public ActionResult&lt;IEnumerable&lt;string&gt;&gt; Get()
{
    return new string[] { &quot;value1&quot;, &quot;value2&quot; };
}
</code></pre>
<h3 id="en-otro-archivo-con-el-mismo-nombre-del-controlador">En otro archivo con el mismo nombre del controlador</h3>
<p>Este es el modelo elegido porque permite escalar, si es un proyecto más chico se puede usar el anterior.</p>
<p>Se necesita definir un namespace para el controlador y otro para el archivo de versionado. En el archivo de versionado se define la versión y el namespace del controlador.
En este caso los tags de las versiones se agregan en cada archivo, representando cada archivo con su version correspondiente.</p>
<pre><code class="language-csharp">namespace ApiVersioning.Controllers.V1; // esto podría no hacer falta si esta configurado un default namespace a nivel del proyecto

[ApiController]
[ApiVersion(&quot;1.0&quot;)]
[Route(&quot;v{version:apiVersion}/[controller]&quot;)]
[Route(&quot;[controller]&quot;)]
public class ValuesController : ControllerBase
{
    [HttpGet]
    public ActionResult&lt;IEnumerable&lt;string&gt;&gt; Get()
    {
        return new string[] { &quot;value1&quot;, &quot;value2&quot; };
    }
}

</code></pre>
<pre><code class="language-csharp">namespace ApiVersioning.Controllers.V2
{
    [ApiController]
    [ApiVersion(&quot;2.0&quot;)]
    [Route(&quot;v{version:apiVersion}/[controller]&quot;)]
    [Route(&quot;[controller]&quot;)]
    public class ValuesController : ControllerBase
    {
        [HttpGet]
        public ActionResult&lt;IEnumerable&lt;string&gt;&gt; Get()
        {
            return new string[] { &quot;value1&quot;, &quot;value2&quot;, &quot;value3&quot; };
        }
    }
}
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../nginx_config_angular/" class="btn btn-neutral float-left" title="Nginx angular"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../authentication/" class="btn btn-neutral float-right" title="authentication">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../nginx_config_angular/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../authentication/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
