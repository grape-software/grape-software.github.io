<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Fernando Ruiz" /><link rel="canonical" href="https://grape-software.github.io/angular/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Angular - Grape Docs</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Angular";
        var mkdocs_page_input_path = "angular.md";
        var mkdocs_page_url = "/angular/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Grape Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../working/">Working</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../semantic-release/">Releasing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../netcore/logs/">Logs</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Angular</a>
    <ul class="current">
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../autocomplete/">Autocomplete</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../b4to5/">Bootstrap 4 to 5</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../netcore/http-services/">External Services</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../linter/">Linter Config</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../microfronts/">Microfronts</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../netcore/microservices/">Microservices</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../schema-compare/">Schema Compare</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../videos/">Videos snippets</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../powerbi/">Powerbi</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../environment-dev/">Environment Dev</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../neox/">Neox deploy</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ms-jobs/">Microservicio Jobs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../nginx_config_angular/">Nginx angular</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../netcore/versioning/">versionning</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Grape Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Angular</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="angular">Angular</h1>
<p>Proyectos de angular</p>
<ol>
<li>ng new PROYECT</li>
<li>Ejecutar los comandos para el linter</li>
</ol>
<pre><code>ng add @angular-eslint/schematics
ng g @angular-eslint/schematics:convert-tslint-to-eslint
</code></pre>
<p>si es microfront</p>
<pre><code>ng add @angular-architects/module-federation
</code></pre>
<p>Componentes comunes</p>
<pre><code>npm i bootstrap
npm i ngx-toastr
npm i @fortawesome/angular-fontawesome
npm i @fortawesome/free-solid-svg-icons
npm i ngx-pagination
npm i ngx-bootstrap
</code></pre>
<p>Configurar angular.js</p>
<pre><code>              &quot;node_modules/bootstrap/dist/js/bootstrap.bundle.min.js&quot;
 y

               &quot;node_modules/bootstrap/scss/bootstrap.scss&quot;,
              &quot;node_modules/ngx-toastr/toastr.css&quot;,


</code></pre>
<p>Copiar:</p>
<ul>
<li>auth.guard.ts</li>
<li>http-token.interceptor.ts</li>
</ul>
<p>Configurar en app.module.ts</p>
<pre><code>imports: [
    BrowserModule,
    FormsModule,
    AppRoutingModule,
    FontAwesomeModule,
    BrowserAnimationsModule,
    // CommonModule,
    RouterModule.forRoot(routes),
    ToastrModule.forRoot({
      timeOut: 3000,
      positionClass: 'toast-bottom-right',
      preventDuplicates: true,
    }),
    ModalModule.forRoot(),
    HttpClientModule,
    TabsModule.forRoot(),
    // NgxPaginationModule,
    // TooltipModule.forRoot(),
    BsDropdownModule.forRoot(),
  ],
  providers: [{ provide: HTTP_INTERCEPTORS, useClass: TokenInterceptor, multi: true }],
</code></pre>
<p>Agregar routes</p>
<pre><code>export const routes: Routes = [
  {
    path: '',
    redirectTo: 'noti',
    pathMatch: 'full',
  },
  {
    path: 'noti',
    loadChildren: () =&gt; import('./notificaciones/notificaciones.module').then((m) =&gt; m.NotificacionesModule),
  },

  {
    path: 'login',
    component: LoginMfeComponent,
  },
</code></pre>
<p>Copiar services helper uy auth para login-mfe</p>
<p>Acomodar app.component.html</p>
<pre><code>&lt;div class=&quot;container&quot;&gt;
  &lt;router-outlet&gt;&lt;/router-outlet&gt;
&lt;/div&gt;

</code></pre>
<h1 id="multi-idiomas">Multi idiomas</h1>
<p>ng add @angular/localize
https://angular.io/guide/i18n-overview</p>
<p>Agregar a los componentes que necesiten ser traducidos
<XXX i18n="@@UniqueTextId"> -&gt; para no repetir se puede armar una lista de los Ids en el proyecto y los textos que traducen</p>
<h2 id="angularjs">angular.js</h2>
<p>En el tag ProjecName agregar:</p>
<pre><code>&quot;i18n&quot;: {
  &quot;sourceLocale&quot;:&quot;es&quot;, --&gt; es el idioma default
  &quot;locales&quot;:{
    &quot;en&quot;:&quot;src/locale/messages.en.json&quot;
  }
}
</code></pre>
<p>en el tag architect:build:options agregar:</p>
<pre><code>&quot;localize&quot;:true --&gt; para que compile en todos los idiomas o &quot;localize&quot;:[&quot;es&quot;] --&gt; para que compile en un idioma predeterminado
</code></pre>
<p>En architect:build:configurations agregar:</p>
<pre><code>&quot;es&quot;:{
  &quot;localize&quot;:&quot;es&quot;
},
&quot;en&quot;:{
  &quot;localize&quot;:&quot;en&quot;
}
</code></pre>
<p>en architect:serve:configurations agregar:</p>
<pre><code>&quot;es&quot;:{
  &quot;browserTarget&quot;:&quot;core:build:es&quot;
},
&quot;en&quot;:{
  &quot;browserTarget&quot;:&quot;core:build:en&quot;
}
</code></pre>
<h2 id="packagejson">package.json</h2>
<p>Se deberá ajustar para que cuando se haga el serve o el build lo haga considerando el multi idioma. Cada vez que se agregue un TAG i18n o $localize en los TS se deberá correr el npm run extract-i18n para reconstruir el messages.json sino tirará un warning que falta una traducción.
en scripts agregar:</p>
<pre><code>&quot;start-es&quot;:&quot;ng serve --configuration=es&quot;,
&quot;start-en&quot;:&quot;ng serve --configuration=en&quot;,
&quot;extract-i18n&quot;:&quot;ng extract-i18n --format=json --output-pat src/locale&quot;, --&gt; esto deja el archivo messages.json que despues hay que pasarlo al ingles copiandolo messages.en.json
</code></pre>
<h2 id="ejemplos-de-codigo-multi-idioma">ejemplos de código multi idioma</h2>
<p>En los módulos para que funcione el $localize es necesario importar: import '@angular/localize/init'
Hay que agregar en providers del/los módulos {provide: LOCALE_ID, useValue:'es'}</p>
<p>en los archivos TS los string que deban ser traducidos se sacan así $localize<code>:@@UniqueTextId:cadena a traducir ${VARIABLE SI NECESITO CONCATENAR ALGO}</code></p>
<p>en los archivos HTML
<XXX i18n="@@UniqueTextId"> -&gt; para no repetir se puede armar una lista de los Ids en el proyecto y los textos que traducen</p>
<h2 id="uso-de-observables">Uso de Observables</h2>
<p>Un observable por lo general se define en la capa de servicios cuando se comparte entre diferentes componentes:</p>
<pre><code>  private objectSubject: BehaviorSubject&lt;any&gt;;
  public object$: Observable&lt;any&gt;;

  constructor() {
    this.objectSubject = new BehaviorSubject&lt;any[]&gt;();
    this.object$ = this.objectSubject.asObservable();
  }
</code></pre>
<p>En el servicio se realizan operaciones que actualizan el privado y tienen que ejecutar el .next (este evento es el que notifica a los suscriptores)</p>
<pre><code>Login(identifier?: string, password?: string) {
    return this.http
      .post(`${environment.apiUrl}/auth/login`, {
        Identifier: identifier,
        Password: password,
      })
      .pipe(
        tap((authResp: any) =&gt; {
          localStorage.setItem('user', JSON.stringify(authResp));
          this.userSubject.next(localUser);
        }),
      );
  }
</code></pre>
<p>Por ultimo queda suscribirse a los observable desde los componentes, esto se realiza de distintas formas:</p>
<ul>
<li>Si es en el template hay que avisar que son async</li>
</ul>
<pre><code>&lt;div class=&quot;d-md-flex justify-content-md-end&quot; *ngIf=&quot;(inscripcionOferta$ | async).length&quot;&gt;
&lt;li class=&quot;list-group-item border-bottom py-0&quot; *ngFor=&quot;let inscripcion of items$ | async&quot;&gt;
</code></pre>
<ul>
<li>Si es en el TS se crea en objeto local y la suscripción. Se suscribe al inicio y se desuscribe al destroy, esto es muy importante.</li>
</ul>
<pre><code>  user: any;
  userSub: Subscription;

  ngOnInit(): void {
    this.userSub = this.authService.user$.subscribe((u) =&gt; {
      if (u != null &amp;&amp; u.userID) {
        this.isLoggedIn = true;
      } else {
        this.isLoggedIn = false;
      }
      this.user = u;
    });
  }
  ngOnDestroy(): void {
    this.userSub.unsubscribe();
  }
</code></pre>
<h2 id="manejo-de-customizacion-de-componentes">Manejo de Customización de componentes</h2>
<p>Para la customización de los componentes se utiliza la tabla TenantsComponents donde se guarda un JSON en value con la estructura de datos definida en el Typescript en Models CustomLOQUESEA referenciado para el TenantId y el nombre del componente de angular.</p>
<p>Primero crear el modelo de datos en Models</p>
<pre><code>export class CustomLOQUESEA {
  atributo: string;
}
</code></pre>
<p>En el componente se debe importar el servicio de customización (ConfComponenteService) y el modelo de datos (CustomLOQUESEA) y se debe inyectar en el constructor.</p>
<pre><code>  custom: CustomLOQUESEA = new CustomLOQUESEA();
  constructor(private confComponenteService: ConfComponenteService) {}
</code></pre>
<p>Luego se llama en ngOnInit al endpoint que obtiene la configuración del componente y se suscribe para obtener la respuesta.</p>
<pre><code>  ngOnInit(): void {
    this.confService.getConfig(this.helpers.getTenantId(), this.constructor.name).subscribe((r: any) =&gt; {
      if (r) {
        Object.assign(this.custom, r);
      }
    });
  }

</code></pre>
<p>En la página HTML se debe utilizar el atributo custom para mostrar los datos que se obtuvieron del endpoint.</p>
<pre><code>  {{
    custom?.atributo
      ? custom?.atributo
      : 'Texto default si no se encuentra la configuración en la tabla TenantsComponents'
  }}
</code></pre>
<h2 id="permissions">permissions</h2>
<p>Los permisos se utilizan para determinar las acciones básicas de los componentes. Estos serán Alta, Baja y Modificación. Estos permisos se definien para los roles o el usuario en las tablas UserAccess o RolesAccess.</p>
<pre><code>permissions = {atributo:valor}
</code></pre>
<p>GET /myaccess devuelve los menús del usuario y dentro de eso deberían estar los permisos.</p>
<h2 id="actions">actions</h2>
<p>La técnica indica agregar un objeto llamado actions en el objeto que se muestra en la tabla. Este objeto tiene los atributos de los iconos que se muestran en la tabla y se evaluan en la función evaluateActions(registro) si se muestran o no con el nombre de la acción y el valor true/false. Corresponde a la visualización o habilitación del icono en la UI.</p>
<pre><code>  evaluteActions(el: any): void {
    const userId = this.helpers.useId;
    const anulado = el.fechaAnulada !== null;
    // sets actions attributes over business object
    el.actions = {};
    el.actions = Object.assign(el.actions, this.actions);
    // evaluate context to show or hide take action
    el.actions.files = !anulado;
    el.actions.delete = el.fechaPresentacionArchivo === null &amp;&amp; !anulado &amp;&amp; !el.aprobada;
    el.actions.desconciliar = el.saldo !== el.total &amp;&amp; !anulado &amp;&amp; !el.aprobada;
    el.actions.conciliar = el.saldo &gt; 0 &amp;&amp; !anulado;
    el.actions.aprobar = !el.aprobada;
  }
</code></pre>
<p>Se dispara luego de cargar los datos en el Search(), por cada registro se ejecuta una funcion evaluateActions(i) que evalua las condiciones para mostrar los iconos de actions.</p>
<pre><code>        this.items.forEach((i) =&gt; {
          this.evaluteActions(i);
        });
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../netcore/logs/" class="btn btn-neutral float-left" title="Logs"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../autocomplete/" class="btn btn-neutral float-right" title="Autocomplete">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../netcore/logs/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../autocomplete/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
