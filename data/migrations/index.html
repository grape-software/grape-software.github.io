<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Fernando Ruiz" /><link rel="canonical" href="https://grape-software.github.io/data/migrations/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Migrations - Grape Docs</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Migrations";
        var mkdocs_page_input_path = "data\\migrations.md";
        var mkdocs_page_url = "/data/migrations/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Grape Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../working/">Working</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../semantic-release/">Releasing</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Net Core</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../netcore/logs/">Logs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../netcore/http-services/">External Services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../netcore/microservices/">Microservices</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../netcore/versioning/">versionning</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../netcore/authentication/">authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../netcore/ms-jobs/">Microservicio Jobs</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Angular</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../angular/angular/">Angular</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../angular/autocomplete/">Autocomplete</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../angular/b4to5/">Bootstrap 4 to 5</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../angular/linter/">Linter Config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../angular/microfronts/">Microfronts</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deploys</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../deploys/nginx_config_angular/">Nginx angular</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../deploys/environment-dev/">Environment Dev</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../deploys/neox/">Neox deploy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Data</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../schema-compare/">Schema Compare</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Migrations</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#usefull-commands">Usefull commands</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#database-schema-consistency">Database Schema Consistency</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#database-migrations-project">Database Migrations Project</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#steps-to-create-a-new-database-migration">Steps to Create a New Database Migration</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#database-migrations">Database Migrations</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#database-migrations-project-structure">Database Migrations Project Structure</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#database-migrations-project-configuration">Database Migrations Project Configuration</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../powerbi/">Powerbi</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../videos/">Videos snippets</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Grape Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Data</li>
      <li class="breadcrumb-item active">Migrations</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="c-microservices-database-schema-consistency">C# Microservices Database Schema Consistency</h1>
<p>dotnet Entity Framework Core tools reference - .NET Core CLI needed
https://learn.microsoft.com/en-us/ef/core/cli/dotnet</p>
<pre><code>dotnet tool install --global dotnet-ef
</code></pre>
<h2 id="usefull-commands">Usefull commands</h2>
<pre><code>dotnet ef migrations add InitialCreate
dotnet ef database update
dotnet ef migrations script --help
</code></pre>
<h2 id="database-schema-consistency">Database Schema Consistency</h2>
<p>When working with microservices, it is important to keep the database schema consistent across all services. This is because the database is shared between all services, and if one service is expecting a certain schema, and another service is expecting a different schema, then the database will be in an inconsistent state. This can lead to errors and data loss.</p>
<h2 id="database-migrations-project">Database Migrations Project</h2>
<p>To help keep the database schema consistent, we have created a database migrations project. This project contains all of the database migrations that are needed to keep the database schema consistent across all services. The database migrations project is located in the <code>src/DatabaseMigrations</code> folder.</p>
<h3 id="steps-to-create-a-new-database-migration">Steps to Create a New Database Migration</h3>
<p>To create a new database migration, follow these steps:
- Create a C# Project
- Add the <code>Microsoft.EntityFrameworkCore.Design</code> NuGet Package
- Add the <code>Microsoft.EntityFrameworkCore.SqlServer</code> NuGet Package
- Add the <code>Microsoft.EntityFrameworkCore.SqlServer.NetTopologySuite</code> NuGet Package
- Add the <code>Microsoft.EntityFrameworkCore.Tools</code> NuGet Package</p>
<pre><code>dotnet add package EFCore.NamingConventions
dotnet add package Npgsql.EntityFrameworkCore.PostgreSQL
dotnet add package Npgsql.EntityFrameworkCore.PostgreSQL.NetTopologySuite
</code></pre>
<h2 id="database-migrations">Database Migrations</h2>
<p>Database migrations are used to update the database schema. They are used to add new tables, columns, indexes, etc. to the database. They are also used to update existing tables, columns, indexes, etc. to the database. Database migrations are used to keep the database schema consistent across all services.</p>
<h2 id="database-migrations-project-structure">Database Migrations Project Structure</h2>
<p>The database migrations project is structured as follows:</p>
<pre><code>src/DatabaseMigrations
├── DatabaseMigrations.csproj
├── Migrations
│   ├── 20210101000000_Initial.cs
│   ├── 20210101000000_Initial.Designer.cs
│   ├── 20210101000000_Initial.sql
│   ├── 20210101000001_AddedColumn.cs
│   ├── 20210101000001_AddedColumn.Designer.cs
│   ├── 20210101000001_AddedColumn.sql
</code></pre>
<p>The <code>DatabaseMigrations.csproj</code> file contains the project configuration. The <code>Migrations</code> folder contains all of the database migrations. Each database migration is a C# class that inherits from the <code>Migration</code> class. Each database migration has a <code>cs</code>, <code>Designer.cs</code>, and <code>sql</code> file. The <code>cs</code> file contains the C# code for the database migration. The <code>Designer.cs</code> file contains the C# code for the database migration. The <code>sql</code> file contains the SQL code for the database migration.</p>
<h2 id="database-migrations-project-configuration">Database Migrations Project Configuration</h2>
<p>T</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../schema-compare/" class="btn btn-neutral float-left" title="Schema Compare"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../powerbi/" class="btn btn-neutral float-right" title="Powerbi">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../schema-compare/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../powerbi/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
